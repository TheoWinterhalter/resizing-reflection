\documentclass[11pt]{article}

% Font
% \renewcommand{\familydefault}{\sfdefault}
% \usepackage{helvet}
% \usepackage[sfdefault,light]{roboto}

\usepackage[T1]{fontenc} %
% \usepackage[latin1]{inputenc} %
\usepackage[utf8]{inputenc} %
% \usepackage[applemac]{inputenc} %
% \usepackage{a4wide} %

% \setlength{\parskip}{0.3\baselineskip}

\usepackage{amsmath, amssymb, amsfonts, stmaryrd}
\usepackage{mathrsfs}
\usepackage{amsthm}
\usepackage{bm}
\usepackage{pifont}

% Add some colors
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage{hyperref}
\hypersetup{
 linktocpage,
 colorlinks,
 citecolor=BlueViolet,
 filecolor=red,
 linkcolor=Blue,
 urlcolor=BrickRed
}

% NTH
\usepackage[super]{nth}

% For EPS figures
\usepackage{graphicx}
\usepackage{epstopdf}
\usepackage{wrapfig}

% Theorems
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}%[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem*{note}{Note}
\newtheorem{definition}{Definition}

\theoremstyle{remark}
\newtheorem*{example}{Example}

% Meta comment
\newcommand\meta[1]{\noindent\textcolor{blue}{\emph{#1}}}

% Include the macro file
\input{macros}

\begin{document}

\title{Justifying Resizing Rules in HoTT \\
\small{Through an interpretation of extensional type theory into an intensional
one}}

\author{Théo Winterhalter, Nicolas Tabareau (ASCOLA, LINA)}

\date{\nth{5} of September, 2016}

\maketitle

\pagestyle{empty} %
\thispagestyle{empty}

%% Attention: pas plus d'un recto-verso!
% Ne conservez pas les questions


\subsection*{The general context}
% What is it about ? Where does it come from ?
% What is the state of the art in this area ?
Homotopy Type Theory (HoTT for short) is a new domain that aims to offer a new
axiomatisation of mathematics that allows to consider objects up to isomorphisms
(as a result of the univalence axiom which allows to derive an equality between
isomorphic types).
The underlying theory thus develops a lot of notions related to equality and its
treatment, in particular it theorises about equalities between equalities that
are often considered to be trivial as they are in Set Theory.

\subsection*{The research problem}

% What is the question that you studied ?
% Why is it important, what are the applications/consequences ?
% Is it a new problem ?
% If so, why are you the first researcher in the universe who consider it ?
% If not, why did you think that you could bring an original contribution ?
In type theory, and thus in proof assistants such as Coq or Agda, in order to
avoid paradoxes \emph{à la} Russel, we have to establish a hierarchy of
universes (the types of types). Without it, it would be possible to prove
\emph{false} in Coq for instance.
Nevertheless, the typing rules dealing with universes are purely syntactical
and can be seen as rough approximations to preserve consistency.
They can be annoying for the user and we can legitimately wonder whether we
can alleviate theses restrictions in some specific cases.

Stated by Vladimir Voevodsky, the \emph{resizing rules} allow to lower the
universe level of a type under special conditions. The way he presented them
would make type checking undecidable.
We studied the possibility of a definition better suited to implementation
as well as a justification that the rules we propose preserve the consistency
of the system.

\subsection*{Your contribution}

% What is your solution to the question described in the last paragraph ?
% Be careful, do \emph{not} give technical details, only rough ideas !
% Pay a special attention to the description  of the \emph{scientific} approach.
We propose a way to implement resizing rules in Coq (which will be possible in
the next release) with precise typing rules.
We then show that -- up to some axioms that are consistent in a univalent
setting -- all resizing rules that we proposed (and that correspond to the ones
of Voevodsky) can be reduced to only one.
We finally show the consistency of this one rule by generalizing a result by
Marc Oury stating that we can translate extensional type theory into
intensional type theory in a univalent setting (up to now it relied on the
uniqueness of identity proofs that is incompatible with univalence).
This last step is, in itself, an interesting result.

\subsection*{Arguments supporting its validity}

% What is the evidence that your solution is a good solution ?
% Experiments ? Proofs ?
Our work consists of a proof and an implementation.
However, our proof relies on some axioms that we deem consistent in a univalent
setting but this would require more work to justify their use more explicitely.

% Comment the robustness of your solution:
% how does it rely/depend on the working assumptions ?

\subsection*{Summary and future work}

% What is next ? In which respect is your approach general ?
% What did your contribution bring to the area ?
% What should be done now ?
% What is the good \emph{next} question ?
Our approach goes through a very gereral interpretation of extensional type
theory into intensional type theory which is an interesting result unavailable
in homotopy type theory. Besides we allow the use of resizing rules in actual
proofs in Coq.
Still, as we pointed out, we rely on an axiom and it would be interesting to
see if it holds in the simplicial model which is the mainstream model of
univalent homotopy type theory.

\subsection*{Notes}

Given that the translation from extensional type theory into intensional type
theory without using uniqueness of identity proofs and that justifying
resizing rule might serve as a basis for articles we decided to write this
report in English.

\newpage
\pagestyle{plain} %

\section{Homotopy Type Theory}

We will start by briefly presenting type theory and then go to its homotopic
counterpart.

\subsection{Proof Theory and Proof Assistants}

The Curry-Howard isomorphism sets the basis for seeing $\lambda$-terms as
proofs and types as propositions. Since then, many systems such as
Martin-L\" of Type Theory (the theory behind Agda) or the Calculus of
Inductive Constructions (CIC -- the theory behind Coq) extended it to dependent
types that allow types to depend on terms.
% This way, the dependent product $\Pi x:A.B$ (where $B$ can mention $x$)
% represents the proposition $\forall x:A, B$.
We shall assume the reader is familiar with basic concepts associated to CIC
such as the inductive types as CIC will serve as our implicit context.

\subsection{Proofs and Equality}

Even though in Coq, one notion of equality is built-in: conversion which
identifies terms up to $\beta$-reductions, it is often interesting to talk
about equality inside of proof terms.
We thus use the so-called identity types $\Id\ A\ u\ v$ (meaning the type of
proofs that $u$ and $v$ of type $A$ are equal; often written
$u =_A v$ or even $u = v$ when $A$ is understood) such that $\Id\ A\ x\ x$
have one inhabitant: $\refl_x$.
Basically this means that we can only prove equality of objects that are already
convertible without relying on hypotheses of course: this is the smallest
reflexive relation.

\begin{wrapfigure}{r}{0.25\textwidth}
    \centering
    \includegraphics[scale=.4]{s1.eps}
\end{wrapfigure}
Homotopy type theory comes with concepts that tend to inhabit equlity through
other means than reflexivity. For instance, it introduces the notion of
\emph{higher inductive types} that are not only described by constructors but
also by equalities.
The most standard example is probably the circle $\S1$ that has one constructor
$\base : \S1$ and one non-trivial equality $\sloop : \base = \base$
(in the figure on the right we implicitely see an equality as a directed arrow).
This can go against the intuition but this type doesn't have only one element,
\ie it is not provable that $\forall x,y : \S1.\ x = y$. It is however
reassuring that the circle doesn't consist of only one point.
Obviously, all equalities in $\sloop = \sloop$ aren't provably equal either.
However, for a type such as $\bool$ whose elements are clearly not all
identifiable (we can even prove $\true \neq \false$), we can prove (this does
not come easily) that all proofs of $b =_{\bool} b$ are equal.
This gives rise to a classification of types depending on the properties
of their (higher) equalities.

\begin{definition}[$n-\Type$s]
  \leavevmode
  \begin{itemize}
    \item We say a type $T$ is \emph{contractible} (or a $(-2)-\Type$) when
          there is $t : T$ such that $\forall x : T. x = t$.
    \item We say that $T$ is an $(n+1)-\Type$ when for all $x, y : T$, the type
          $x =_T y$ is an $n-\Type$.
  \end{itemize}
\end{definition}
%
\noindent
In particular, we shall say that a $(-1)-\Type$ is a \emph{(mere) proposition}
following the intuition that such a type is either \emph{true} ($\top$ -- the
unit type) or \emph{false} ($\bot$ -- the empty type).
We also say that a $0-\Type$ is a \emph{set} as it verifies uniqueness of
identity proofs as sets of set theory.

\paradot{Transport}
We represented the circle by drawing $\sloop$ as a path from $\base$ to
$\base$, this way of representing the equality can be explicited by the notion
of transport.
Basically, given $p : A =_{\Type} B$, it is possible to construct a function
$p_* : A \to B$ using the elimination principle of equality.

\paradot{Operations}
The elimination principle for equality can be annoying to use in general so we
rather prove basic lemmata that make reasoning about equality easier.
One that is useful for instance is the congruence of equality under application:
\[ \ap : \forall (f : A \to B).\ x =_A y \to f\ x =_B f\ y. \]

\subsection{Univalence}

As we already mentioned, univalence is a principle that basically allows to
identify objects that are equivalent. To really give meaning to those words we
need to define what we mean by equivalence.

\begin{definition}[Equivalence]
  Given $A$, $B$ and $f : A \to B$, we say that $f$ is an equivalence
  if there exist the following terms:
  \begin{itemize}
    \item $g : B \to A$,
    \item $\eta : \forall a:A.\ g\ (f\ a) = a$,
    \item $\epsilon : \forall b:B.\ f\ (g\ b) = b$,
    \item $\alpha : \forall a:A.\ \ap\ f\ (\eta\ a) = \epsilon\ (f\ a)$.
  \end{itemize}
  We write $A \approx B$ for the type of equivalences between $A$ and $B$.
\end{definition}

\noindent
An interesting to remark is that if $A$ and $B$ are sets, then an equivalence is
exactly a bijection between types (which incidently is the notion of isomorphism
for sets).

Using transports it is trivial to construct an equivalence between to equal
types $A = B$, this gives us an arrow $f : (A = B) \to (A \approx B)$.
The principle of univalence states that this arrow itself is an equivalence.

\begin{definition}[Univalence]
  The trivial arrow $(A = B) \to (A \approx B)$ is itself an equivalence.
\end{definition}

\noindent
This means in particular that to equivalent types are equal (which is usually
how univalence is presented to people that aren't familiar with homotopy type
theory) but it actually says more. The way to construct the equality is related
to the equivalence.
For instance, if you take a look at $\bool$, there are two ways to prove
$\bool = \bool$, the usual straightforward way which corresponds to the identity
and the twisted way coming from univalence that exchanges $\true$ and $\false$.

\section{Resizing Rules}

We will now present the resizing rules and try to justify their need.

\subsection{Motivations}

Consistency in Coq relies on a hierarchy of universes $\Type_i$ with
$\Type_i : \Type_{i+1}$. Even though this is usually transparent to the user
(who only sees $\Type$), sometimes the user gets presented with a
``universe inconsistency''. This happens for instance when a function was
defined over $\Type_3$ but we provided a type in $\Type_4$.
This is of course the expected behavior, however in some cases the universe
level of an object grew artifically.

Take the notion of subsets: if we want to take a subset of $A$ satisfying
a given predicate $P$, we write $B := \{ x : A \mid P\ x \}$ in Coq.
The problem is that $P$ could live in high universes, making the universe level
of $B$ grow as well, meaning it could be bigger than the one of $A$ although
it was originally intended as a subset of $A$.
The consequences are that some properties of $A$ might not be inherited by
$B$ because of universe constraints.
One of the resizing rules proposed by Vladimir Voevodsky states that any
mere proposition can be taken in the smallest universe ($\Type_0$).
In our case it would lower the universe of $P\ x$ and $B$ would fit in the same
universe as $A$.

This is meant as a motivation to research resizing rules but this does not mean
that they are necessary or even strengthen our system.
We will consider them as a tool that makes your life better when dealing with
universe problems in Coq.

\subsection{Original Statement}

\subsection{Implementation Proposal}

\section{One Rule to Resize Them All}

\section{Extensional to Intensional}

\section*{Conclusion}

\end{document}
