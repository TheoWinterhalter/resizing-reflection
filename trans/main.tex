\documentclass[a4paper,english]{lipics-utf8x}

\usepackage[T1]{fontenc} %

\usepackage{amsmath, amssymb, amsfonts, stmaryrd}
\usepackage{bm}
\usepackage{pifont}
\PrerenderUnicode{é} % For the author names in the heading

% Add some colors
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage{hyperref}
\hypersetup{
 linktocpage,
 colorlinks,
 citecolor=BlueViolet,
 filecolor=red,
 linkcolor=Blue,
 urlcolor=BrickRed
}

\usepackage{graphicx}
\usepackage{placeins}

% Meta comment
\newcommand\meta[1]{\noindent\textcolor{blue}{\emph{#1}}}

% Include the macro file
\input{macros}

% Title and so...
\title{Working Resizing of Equivalence under Univalence}
\author[1]{Théo Winterhalter}

\begin{document}

  \maketitle

  \begin{abstract}
    ...
  \end{abstract}

  \section{Our systems}

  This is the syntax of the system in which we start.

  \[
    \begin{array}{l@{~}l@{~}l@{~}r@{~}l@{\quad}l}
      \Var  & \ni & x,y,X,Y \\
      \Sort & \ni & s             & ::= & \Type_k \mbox{ }
                                                (k \in \mathbb{N}) \\
      \Exp  & \ni & t,u,T,U & ::= & s \mid \Pi x:U.T \mid
                                    \Id T\ t\ u \\
                         &&& \mid & x \mid \lambda x:U.t \mid t~u
                               \mid \refl(T,t) \mid
                               \J (T,U,t_{refl},u_1,u_2,t_{eq}) \\
      \Ctx  & \ni & \Gamma  & ::= & \cdot \mid \Gamma, x:T \\
    \end{array}
  \]
  %
  We assume it contains $\mA$ and $\mB$ that are equivalent (and respectively in
  universes $\sA$ and $\sB$), but up to univalence, we only assume that
  there is $\me$ such that $\der \me : \Id s\ \mA\ \mB$ for some $s$
  (note: we will only treat the case where this holds in the empty context,
  but it should scale easily).

  We then extend this system with $\mR$, $\inj(t)$ and $\proj(t)$ as well as
  the following rules (which we will note with $\derr$ instead of $\dere$).

  \begin{mathc}
    \ru{\derr \Gamma
      }{\Gamma \derr \mR : \sB}
    \qquad
    \ru{\Gamma \derr t : \mA
      }{\Gamma \derr \proj(\inj(t)) = t : \mA}
    \qquad
    \ru{\Gamma \derr t : \mR
      }{\Gamma \derr \inj(\proj(t)) = t : \mR}
  \end{mathc}

  \section{Translation for Consistency}

  Because our translation is based on the derivation of a judgement and not
  only the judgement itself, we need to have some criterium of compatibility.
  It will also be helpful to ensure that the empty type is mapped to something
  close to the empty type (as in, it is empty as well).

  We will write $\msigma$ for the substitution
  $[\mA := \mA, \mB := \mA, \me := \refl(s,\mA)]$.
  And in the following $\Gamma \dere t = t'$ shall mean that there exists $A$
  such that $\Gamma \dere t = t' : A$ holds.

  \begin{definition}[$\Gamma$-translation]
    For any context $\dere \Gamma$ we define the notion of $\Gamma$-translation
    of a term $u$ (in PTSe) by induction on $u$.
    \begin{itemize}
      \item $t$ is a $\Gamma$-translation of $s$ if $\Gamma \dere t \sigma = s$.
      \item $t$ is a $\Gamma$-translation of $\Pi x:A.B$ if
            $\Gamma \dere t \sigma = \Pi x:A'.B'$ where $A'$ is a
            $\Gamma$-translation of $A$ and $B'$ is a
            $(\Gamma, x:A')$-translation of $B$.
      \item $t$ is a $\Gamma$-translation of $\Id A\ u\ v$ if
            $\Gamma \dere t \sigma = \Id A'\ u'\ v'$ where $A',u',v'$ are
            $\Gamma$-translations of $A,u,v$ respectively.
      \item $t$ is a $\Gamma$-translation of $x$ if $\Gamma \dere t \sigma = x$.
      \item $t$ is a $\Gamma$-translation of $\lambda x:A.b$ if
            $\Gamma \dere t \sigma = \lambda x:A'.b'$ where $A'$ is a
            $\Gamma$-translation of $A$ and $b'$ is a
            $(\Gamma, x:A')$-translation of $b$.
      \item $t$ is a $\Gamma$-translation of $a\ b$ if
            $\Gamma \dere t \sigma = a'\ b'$ where $a',b'$ are
            $\Gamma$-translations of $a,b$ respectively.
      \item $t$ is a $\Gamma$-tanslation of $\refl(A,u)$ if
            $\Gamma \dere t \sigma = \refl(A',u')$ where $A',u'$ are
            $\Gamma$-translations of $A,u$ respectively.
      \item \sloppy
            $t$ is a $\Gamma$-tanslation of $\J(A,C,b,u,v,p)$ if
            $\Gamma \dere t \sigma = \J(A',C',b',u',v',p')$ where
            $A',C',b',u',v',p'$ are $\Gamma$-translations of
            $A,C,b,u,v,p$ respectively.
      \item $t$ is a $\Gamma$-translation of $\mR$ if
            $\Gamma \dere t \sigma = \mA$.
      \item $t$ is a $\Gamma$-translation of $\inj(u)$ if
            $\Gamma \dere t \sigma = u'$ where $u'$ is a $\Gamma$-translation
            of $u$.
      \item $t$ is a $\Gamma$-translation of $\proj(u)$ if
            $\Gamma \dere t \sigma = u'$ where $u'$ is a $\Gamma$-translation
            of $u$.
    \end{itemize}
  \end{definition}

  \meta{Shouldn't the $\msigma$ be in the context as well??}

  \begin{definition}[Context Translation]
    We define translations of a context $\Gamma$ by induction on $\Gamma$:
    \begin{itemize}
      \item $\cdot$ is a translation of $\cdot$.
      \item $\Gamma', x:A'$ is a translation of $\Gamma, x:A$ if $\Gamma'$ is
            a translation of $\Gamma$ and $A'$ is a $\Gamma'$-translation of
            $A$.
    \end{itemize}
  \end{definition}
  %
  Before dealing with our theorem, we will look at a few lemmata regarding the
  translation.

  \begin{lemma}[Equality of translations]
    \label{lem:transleq}
    If $t$ and $t'$ are both $\Gamma$-translations of the same term $u$ then
    there exists $A$ and $e$ such that $\Gamma \dere e : \Id A\ t\ t'$.
    \meta{Besides, $e\msigma$ is convertible to $\refl$ (say it explicitely).}
  \end{lemma}

  \begin{proof}
    Formally we prove by induction that $\Gamma \dere t \msigma = t' \msigma$
    meaning $\Gamma \dere t \msigma = t' \msigma : T\msigma$ for some $T$
    (\meta{This is only true if $t$ and $t'$ can have the same type, we should
    precise who is the type in the definition of translation then.
    There is also the problem of having a type under the substitution!}).
    Then we have
    \[\Gamma \dere \J(s,\lambda \mA, \mB, \me. \Id T\ t\ t',
    \lambda \mA. \refl(T\msigma,t\msigma),\mA,\mB,\me) : \Id T\ t\ t'.\]
    (implicitely, we replace $\mA,\mB,\me$ in $T,t,t'$ by the ones of the
    $\lambda$ which may not be really pretty, but you have to admit it's easier
    written this way, basically, the only thing this does is destructing
    equality $\me$ (as one would do in Coq) and then apply reflexivity).
    \meta{Under $\msigma$, $\me$ becomes $\refl$, so does the whole $\J$.}
  \end{proof}


  We can now go on defining the theorem using the above definitions.

  \begin{theorem}[Translation]
    \leavevmode
    \begin{enumerate}
      \item If $\Gamma \derr t : T$ then there exists $\Gamma'$ a well-formed
      translation of $\Gamma$ and for any such $\Gamma'$, there are $t'$ and
      $T'$, $\Gamma'$-translations of $t$,$T$,
      such that $\Gamma' \dere t' : T'$.
      \item If $\Gamma \derr t = u : T$ then there exists $\Gamma'$ a
      well-formed translation of $\Gamma$ and for any such $\Gamma'$, there are
      $t'$, $u'$ and $T'$, $\Gamma'$-translations of $t$, $u$, $T$, and $h$ such
      that $\Gamma' \dere h : \Id T'\ t'\ u'$.
      \item If $\derr \Gamma$ then there exists $\Gamma'$ a translation of
      $\Gamma$ such that $\dere \Gamma'$.
    \end{enumerate}
  \end{theorem}

  \begin{proof}
    By induction on the derivation.

    \leavevmode
    \begin{caselist}
      \nextcase
      \begin{mathc}
        \ru{\Gamma \derr a : A \qquad
            \Gamma \derr A = B : s
          }{\Gamma \derr a : B}
      \end{mathc}
      By the first induction hypothesis, there are $\Gamma'$, $a'$ and $A'$
      such that $\Gamma' \dere a' : A'$ (and that are translations).
      Then, we can instantiate the second induction hypothesis with $\Gamma'$:
      we thus have $A'',B',t$ that are $\Gamma'$-translations of $A,B,s$ and
      $h$ such that $\Gamma' \dere h : \Id t\ A''\ B'$.
      By lemma~\ref{lem:transleq}, there is $h'$ such that
      $\Gamma' \dere h' : \Id s'\ A'\ A''$ for some $s'$ (\meta{at some point
      we should say where it comes from}).
      Then $\Gamma' \dere (h \cons h')_*\ a' : B'$ with everything being
      $\Gamma'$-translations.

      \nextcase
      \begin{mathc}
        \rux{\Gamma \derr A_1 = A_2 : s_1 \qquad
             \Gamma, x : A_1 \derr b_1 = b_2 : B : s_2
           }{\Gamma \derr \lambda x:A_1.b_1 = \lambda x:A_2.b_2 : \Pi x:A_1.B
           }{(s_1,s_2,s_3)}
      \end{mathc}
      \meta{It seems that if they give me a translation of $\lambda x:A_1.b_1$,
      I cannot deduce one of $A_1$ (at least not that easily).}
    \end{caselist}
  \end{proof}

\end{document}
